# 開発セッション記録 2025-12-11

## 実装内容サマリー

本日のセッションでは、**Phase 2 Week 7（PPT生成機能）の要件定義を更新**し、ユーザーからの3つの重要なフィードバックを反映しました。Gensparkプロンプト生成の品質を向上させ、より実用的で視覚的に分かりやすいプレゼンテーション生成を実現する設計に改善しました。

---

## 1. セッション開始時の状況確認

### プロジェクトの現状レビュー

**進捗状況**:
- **Phase 1**: 95%完了（UAT準備完了）
- **Phase 2 Week 1-6**: 100%完了 ✅
  - ナレッジベース管理機能
  - ベクトル検索機能
  - ファイルアップロード（Word/PDF）
  - 参照例管理（CRUD + 自動タグ付け）
- **Phase 2 Week 7**: 0%完了（要件定義のみ完成）

**最新コミット**: `11d2148` - Phase 2 Week 7 PPT生成機能の完全な要件定義を作成

**ドキュメント状況**:
- `requirements_phase2_ppt_generation.md` - 完全な要件定義書（50ページ相当）
- `specifications_ppt_generation_functional.md` - 機能仕様書（6画面設計）
- `specifications_ppt_generation_technical.md` - 技術仕様書
- `implementation_plan_week7_ppt_generation.md` - 実装計画書（7日間）

---

## 2. ユーザーフィードバックと要件変更

### 2.1 フィードバック内容

ユーザーからGensparkプロンプト生成例を確認後、以下の3つの改善要望を受けました：

1. **教授のコメントを別立てで出すのではなく、構成の中に教授の思考を入れる**
   - 現状の「Professor's Message」セクションは不自然
   - 本文の中に自然に統合してほしい

2. **スライドサイズは全て揃えてほしい**
   - 16:9で統一することを明示的に指定

3. **図や写真を入れてわかりやすくしたい**
   - アイコン、図表、写真、インフォグラフィックスなどの視覚要素を含める

### 2.2 要件変更の背景

**問題点**:
- 従来の設計では、教授の言葉が別枠（Quote Box）として表示される想定
- これでは「講演者の思考」が本文から分離され、不自然な構成になる
- 視覚要素の指示が不明確で、テキスト中心のスライドになる可能性
- スライドサイズの統一が明記されていない

**改善の方向性**:
- 教授の思考を箇条書きやナレーションの中に自然に埋め込む
- 各スライドに具体的な視覚要素の指示を含める
- 16:9フォーマットを明示的に指定

---

## 3. 実施した要件定義の更新

### 3.1 Design Specificationsの追加

**ファイル**: `docs/requirements_phase2_ppt_generation.md`

**追加内容**:

#### Slide Format（新規セクション）
```markdown
### Slide Format
- **Aspect Ratio**: 16:9 (Standard presentation format)
- **Consistent sizing across all slides**
- Optimized for modern projectors and displays
```

#### Visual Elements Guidelines（新規セクション）
```markdown
### Visual Elements Guidelines
- **Icons & Pictograms**: Use simple, meaningful icons to represent concepts
  - Examples: lightbulb for ideas, arrow for growth, handshake for partnership
- **Charts & Diagrams**: Include flowcharts, step diagrams, comparison tables
  - Visual representation of processes and data
- **Photos & Illustrations**: Use relevant images to convey situations
  - Examples: women entrepreneurs, business scenes, collaboration
- **Infographics**: Visualize statistics and data clearly
  - Examples: pie charts, percentage visualizations
- **Placement**: Balance text and visuals, avoid overcrowding
- **Consistency**: Maintain visual style across all slides
```

**変更箇所**: `requirements_phase2_ppt_generation.md:572-612`

---

### 3.2 Content Structureの更新

**変更内容**: 各スライドの構成を以下のように変更

#### 変更前（Slide 2の例）:
```markdown
### Slide 2: Self Introduction

**Title**: 自己紹介

**Content**:
- パナソニックに34年間勤務、取締役まで務める
- 海外事業の立ち上げ・運営の豊富な経験

**Professor's Message**:
"事業を始めるのに、完璧な準備は必要ありません。
大切なのは「誰かの課題を解決したい」という想いと、
小さな一歩を踏み出す勇気です。"

**Design Notes**:
- Left-aligned content
- Professor's message in a highlighted box
```

#### 変更後:
```markdown
### Slide 2: Self Introduction

**Title**: 自己紹介

**Content**:
- パナソニックに34年間勤務、取締役まで務める
- 海外事業の立ち上げ・運営の豊富な経験
- M&A（企業買収・合併）を多数リード
- 新規事業の立ち上げを複数経験
- 私の経験から言えることは、事業を始めるのに完璧な準備は必要ないということです
- 大切なのは「誰かの課題を解決したい」という想いと、小さな一歩を踏み出す勇気です

**Visual Elements**:
- Professional headshot or silhouette icon (top-right)
- Career timeline infographic showing 34 years at Panasonic
- Icons for each achievement (building for overseas business, handshake for M&A, rocket for new ventures)

**Design Notes**:
- Left-aligned content with balanced text and visuals
- Professional yet approachable layout
- Use secondary color (coral pink) for visual accents
```

**主な変更点**:
1. ✅ **「Professor's Message」セクションを削除**
2. ✅ **教授の言葉を箇条書きの一部として統合**
3. ✅ **「Visual Elements」セクションを新規追加**
4. ✅ **具体的なビジュアル指示を記載**

**変更箇所**: `requirements_phase2_ppt_generation.md:641-661`

---

### 3.3 技術仕様書の更新

**ファイル**: `docs/specifications_ppt_generation_technical.md`

**変更内容**: `generate_genspark_prompt`関数に設計方針を追加

```python
async def generate_genspark_prompt(
    markdown: str,
    profile: dict
) -> str:
    """Gensparkプロンプト組み立て

    重要な設計方針:
    1. 教授の思考を本文に統合（別枠にしない）
    2. スライドサイズを16:9で統一
    3. 各スライドに視覚要素の指示を含める
    """
    speaker_section = build_speaker_profile(profile)
    design_section = build_design_specs(profile['design_preferences'])
    # 16:9のアスペクト比指定を追加
    design_section += "\n\n### Slide Format\n- Aspect Ratio: 16:9\n- Consistent sizing across all slides"
    content_section = convert_markdown_to_genspark(markdown)
    # 視覚要素の指示を含める
    visual_guidelines = build_visual_guidelines()

    return f"""# Presentation Generation Request

{speaker_section}

{design_section}

{visual_guidelines}

{content_section}
"""
```

**変更箇所**: `specifications_ppt_generation_technical.md:153-181`

---

## 4. 更新されたGensparkプロンプト生成例

### 入力プロンプト（サンプル）

```
夫人会で講演することになりました。40代の女性の集まりで、個人事業主、またはこれから仕事を始めたいと考えている方々です。私は海外での事業経験が長く、新規事業立ち上げ、M&Aの経験を多くしてきました。パナソニックに34年間務め、取締役まで務めました。そんな私から彼女たちにどのような講演をすれば良いか、その講演内容の要旨を書いてください。
```

### 生成されるプロンプトの構造

```markdown
# Presentation Generation Request

## Speaker Profile
（変更なし）

## Design Specifications
### Slide Format          ← 🆕 追加
- Aspect Ratio: 16:9
- Consistent sizing across all slides

### Visual Style
（既存）

### Visual Elements Guidelines  ← 🆕 追加
- Icons & Pictograms
- Charts & Diagrams
- Photos & Illustrations
- Infographics
- Placement & Consistency

## Content Structure

### Slide 1: Title Slide
**Visual Elements**:      ← 🆕 追加
- Background: Subtle gradient...
- Central icon: Empowered woman silhouette...

### Slide 2: Self Introduction
**Content**:
- （教授の思考が統合された箇条書き）  ← 🆕 変更
**Visual Elements**:      ← 🆕 追加
- Professional headshot...
- Career timeline infographic...
- Icons for achievements...

（以降、全17スライド）
```

### 主な改善点

1. ✅ **教授の個性が自然に表現される**
   - 別枠ではなく、本文の流れの中に統合
   - 例：「私の経験から言えることは...」

2. ✅ **視覚的に分かりやすい**
   - 各スライドに具体的なビジュアル指示
   - アイコン、図表、写真、インフォグラフィックス
   - テキストと視覚のバランス（60:40または50:50）

3. ✅ **一貫性のある品質**
   - 16:9で全スライド統一
   - Design Specificationsで明確に指定

---

## 5. 完全なプロンプト生成例

17スライド全体の詳細な生成例を作成しました（約18,000文字）。

### スライド構成

| # | タイトル | 視覚要素の例 |
|---|---------|------------|
| 1 | Title Slide | グラデーション背景、エンパワーメントアイコン |
| 2 | Self Introduction | キャリアタイムライン、達成アイコン |
| 3 | 40代の可能性 | 3つの強みを示す相互関係図 |
| 4 | 海外で見た女性起業家の共通点 | 4象限インフォグラフィック |
| 5 | 事業の始め方 ステップ1 | フローチャート、問題発見イラスト |
| 6 | 事業の始め方 ステップ2 | サイクル図、反復改善プロセス |
| 7 | 事業の始め方 ステップ3 | ネットワーク図、チームコラボレーション |
| 8 | 女性ならではの強み | 4柱インフォグラフィック |
| 9 | 40代から始める利点 | タイムライン、成長曲線 |
| 10 | 活用できるツールとリソース | グリッドレイアウト、ツールアイコン |
| 11 | 成功事例：40代女性起業家 | 3列ケーススタディ |
| 12 | よくある不安と、その答え | Q&A形式、障壁克服メタファー |
| 13 | グローバルな視点 | 世界地図、接続線 |
| 14 | 今日から始める3つのアクション | 3ステップ図、階段イラスト |
| 15 | 私からのメッセージ | ミニマル、日の出メタファー |
| 16 | リソースと次のステップ | 4カテゴリーグリッド |
| 17 | Closing & Q&A | シンプルなクロージングデザイン |

### 文字数
- 約18,000文字（推奨範囲: 15,000-20,000文字）
- GensparkのAPI制限内で十分に動作

---

## 6. 実装への影響

### 6.1 バックエンド実装

**新規追加が必要な関数**:

```python
def build_visual_guidelines() -> str:
    """視覚要素のガイドラインを生成"""
    return """
### Visual Elements Guidelines
- Icons & Pictograms: Use simple, meaningful icons
- Charts & Diagrams: Include flowcharts, step diagrams
- Photos & Illustrations: Use relevant images
- Infographics: Visualize statistics clearly
- Placement: Balance text and visuals
- Consistency: Maintain visual style
"""

def convert_markdown_to_genspark(markdown: str) -> str:
    """Markdown内容をGensparkプロンプトに変換

    重要: 教授の思考が箇条書きに含まれていることを確認
    各スライドに**Visual Elements**セクションを追加
    """
    # Markdownパース
    # スライドごとにVisual Elements指示を自動生成
    # または、ユーザーが編集時に追加できるようにする
    pass
```

**変更が必要な関数**:
- `generate_genspark_prompt`: 視覚要素ガイドラインを含める
- `generate_markdown_content`: 教授の思考を本文に統合するよう指示

### 6.2 フロントエンド実装

**影響は最小限**:
- UIの変更は不要
- Markdown編集画面でユーザーが視覚要素の指示を追加できるように、ヒントを表示することを推奨

---

## 7. 次のステップ

### 実装優先順位（Phase 2 Week 7）

**Day 1-2: データベース + バックエンド基盤**
- [ ] `professor_profile` テーブル作成
- [ ] `ppt_generations` テーブル作成
- [ ] APIエンドポイント骨格実装

**Day 3-4: コア機能実装**
- [ ] `utils/ppt_generator.py` 実装
  - `generate_search_queries()`
  - `search_knowledge_base()`
  - `generate_markdown_content()` ← 教授の思考統合ロジック
  - `generate_genspark_prompt()` ← 視覚要素ガイドライン追加
  - `build_visual_guidelines()` ← 新規

**Day 5: フロントエンド実装**
- [ ] プロンプト入力画面 (`/ppt/generate`)
- [ ] 生成中の進捗表示
- [ ] Markdown編集画面
- [ ] プレビュー機能

**Day 6: 履歴管理 + 統合テスト**
- [ ] 履歴一覧・詳細表示 (`/ppt/history`)
- [ ] エンドツーエンドテスト

**Day 7: デプロイ + ドキュメント**
- [ ] Railway デプロイ
- [ ] ユーザーマニュアル作成

---

## 8. 重要な設計決定事項

### 8.1 教授の思考の統合方法

**システムプロンプトでの指示**:
```python
system_prompt = f"""
あなたは教授の講演内容を生成するアシスタントです。

重要な指示:
1. 教授の思考や言葉は、別セクションにせず、本文の箇条書きやナレーションの中に自然に統合してください
2. 「私の経験から...」「私が〜で学んだのは...」のような形で、教授の一人称で語ってください
3. 教授の特徴的なフレーズを適切に散りばめてください

教授のプロファイル:
{profile}

教授のナレッジベース:
{knowledge_text}
"""
```

### 8.2 視覚要素の指示方法

**アプローチ1（推奨）**: システムが自動生成
- LLMがスライドの内容に応じて適切な視覚要素を提案
- 例：「ステップ図」→ フローチャート、「統計」→ インフォグラフィック

**アプローチ2**: ユーザーが編集時に追加
- Markdown編集画面でテンプレートを提供
- ユーザーが各スライドに `**Visual Elements**:` セクションを追加

**実装時の判断**: アプローチ1を優先、アプローチ2も可能にする

---

## 9. 品質保証

### テスト項目（Week 8実施予定）

1. **生成内容の品質テスト**
   - [ ] 教授の思考が自然に統合されているか
   - [ ] 視覚要素の指示が各スライドに含まれているか
   - [ ] 16:9指定が明記されているか

2. **Gensparkでの実行テスト**
   - [ ] 生成されたプロンプトでPPTが正常に生成されるか
   - [ ] スライドサイズが統一されているか
   - [ ] 視覚要素が適切に反映されているか

3. **ユーザーテスト**
   - [ ] 教授が「自分らしい」と感じるか
   - [ ] 視覚的に分かりやすいPPTができるか
   - [ ] 編集が必要な箇所は最小限か

---

## 10. 変更ファイルのサマリー

### 更新されたファイル

| ファイル | 変更内容 | 行数 |
|---------|---------|------|
| `docs/requirements_phase2_ppt_generation.md` | • Slide Format追加<br>• Visual Elements Guidelines追加<br>• Slide 1, 2の例を更新 | +約50行 |
| `docs/specifications_ppt_generation_technical.md` | • `generate_genspark_prompt`に設計方針追加<br>• `build_visual_guidelines`関数の概念追加 | +約20行 |

### 新規作成されたファイル

| ファイル | 内容 | サイズ |
|---------|------|-------|
| `docs/session_2025-12-11.md` | 本セッション記録 | このファイル |

---

## 11. 見積もりへの影響

### 実装工数への影響

**追加作業**:
- `build_visual_guidelines()` 関数実装: 1-2時間
- システムプロンプトの調整（教授の思考統合）: 2-3時間
- テスト・検証: 2-3時間

**合計追加工数**: 約6-8時間（1日分）

**全体見積もり**:
- 従来: 4-5日間
- 更新後: 5-6日間

### コストへの影響

**変更なし**:
- OpenAI API使用量は同等
- 月¥22、年¥264

---

## 12. まとめ

### 達成したこと

1. ✅ **プロジェクト全体の進捗確認**
   - Phase 1, Phase 2 Week 1-6の完成確認
   - Week 7の現状把握

2. ✅ **ユーザーフィードバックの収集と分析**
   - 3つの重要な改善要望
   - 改善の方向性の確定

3. ✅ **要件定義書の更新**
   - Design Specifications拡張
   - Content Structure改善
   - 技術仕様書の更新

4. ✅ **完全なプロンプト生成例の作成**
   - 17スライドの詳細例
   - 約18,000文字の完全版

### 次のアクション

**即座に実行可能**:
- [ ] 変更内容をgitコミット
- [ ] 実装開始（Day 1: データベース設計）

**Week 7完了条件**:
- [ ] Gensparkプロンプトが正常に生成される
- [ ] 教授の思考が自然に統合されている
- [ ] 視覚要素の指示が各スライドに含まれる
- [ ] 16:9で統一されている
- [ ] Gensparkで美しいPPTが生成される

---

**セッション終了**: 2025-12-11
**記録者**: Claude
**ステータス**: 要件定義更新完了、実装準備完了
